<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Consulta ENADE Contínuo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- PapaParse -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    body {
      background-color: #f8f9fa;
    }
    .container {
      margin-top: 2rem;
      max-width: 1000px;
    }
    table {
      margin-top: 1rem;
      font-size: 0.9rem;
    }
    #results {
      margin-top: 2rem;
    }
  </style>
</head>
<body>
<div class="container">
  <h2 class="mb-4 text-center">Consulta ENADE Contínuo</h2>

  <p><b>Importante:</b> essa ferramenta de apoio NÃO SUBSTITUI os dados oficiais de ENADE, 
    disponibilizados em formato planilha no site do INEP.</p>

  <p><b>Importante II:</b> esse site não é muito otimizado, gasta muita memória, 
    então é mais recomendado utilizar no computador.</p>

  <p>Veja o link oficial em <a href="https://enade.inep.gov.br/enade/#!/relatorioCursos">https://enade.inep.gov.br/enade/#!/relatorioCursos</a></p>

  <div class="card p-3 shadow-sm">
    <div class="row g-3">
      <div class="col-md-6">
        <label for="universidade" class="form-label">Universidade</label>
        <input type="text" id="universidade" class="form-control" placeholder="Digite parte do nome da universidade...">
      </div>
      <div class="col-md-6">
        <label for="curso" class="form-label">Curso</label>
        <input type="text" id="curso" class="form-control" placeholder="Digite parte do nome do curso...">
      </div>
    </div>
  </div>

  <div id="results"></div>


<p>Veja link oficial da avaliação enade por curso: <a href="https://www.gov.br/inep/pt-br/areas-de-atuacao/avaliacao-e-exames-educacionais/enade/resultados">https://www.gov.br/inep/pt-br/areas-de-atuacao/avaliacao-e-exames-educacionais/enade/resultados</a></p>

<p>Veja link oficial dos resultados em planilhas: <a href="https://www.gov.br/inep/pt-br/acesso-a-informacao/dados-abertos/indicadores-educacionais/indicadores-de-qualidade-da-educacao-superior">https://www.gov.br/inep/pt-br/acesso-a-informacao/dados-abertos/indicadores-educacionais/indicadores-de-qualidade-da-educacao-superior</a></p>

<p>Esse site é de código-aberto e oferecido como site estático hospedado no github pages (não coleta nenhum dado!)</p>

<p>Para contribuir, visite o repositório: <a href="https://github.com/ic-uff-oficial/enade-continuo">https://github.com/ic-uff-oficial/enade-continuo</a></p>

</div>

<script>
  let dados = [];

  // ---- Carregar CSV ----
  function carregarCSV(arquivo) {
    return new Promise((resolve, reject) => {
      Papa.parse(arquivo, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: results => resolve(results.data),
        error: err => reject(err)
      });
    });
  }

  async function carregarDados() {
    const d2019 = await carregarCSV("conceito_enade_2019.csv");
    const d2021 = await carregarCSV("conceito_enade_2021.csv");
    const d2022 = await carregarCSV("conceito_enade_2022.csv");
    const d2023 = await carregarCSV("conceito_enade_2023.csv");
    dados = d2019.concat(d2021).concat(d2022).concat(d2023);
    console.log(`Carregados ${dados.length} registros.`);
  }

  // ---- Filtro ----
  function filtrar() {
    const univ = document.getElementById('universidade').value.toLowerCase();
    const curso = document.getElementById('curso').value.toLowerCase();

    const filtrado = dados.filter(l => 
    (!univ || (
      (l["Nome da IES*"] && l["Nome da IES*"].toLowerCase().includes(univ)) ||
      (l["Sigla da IES*"] && l["Sigla da IES*"].toLowerCase().includes(univ)) ||
      (l["Nome da IES"] && l["Nome da IES"].toLowerCase().includes(univ)) ||
      (l["Sigla da IES"] && l["Sigla da IES"].toLowerCase().includes(univ))
    )) &&
      (!curso || (l["Área de Avaliação"] && l["Área de Avaliação"].toLowerCase().includes(curso)))
    ).slice(0, 30);

    mostrarResultados(filtrado);
  }

  // ---- Debounce (espera o usuário parar de digitar) ----
  function debounce(fn, delay) {
    let timeout;
    return (...args) => {
      clearTimeout(timeout);
      timeout = setTimeout(() => fn(...args), delay);
    };
  }

  const filtrarComEspera = debounce(filtrar, 1000); // 500ms = meio segundo

  // ---- Mostrar resultados ----
  function mostrarResultados(lista) {
    const div = document.getElementById('results');
    if (lista.length === 0) {
      div.innerHTML = `<div class="alert alert-warning mt-3">Nenhum resultado encontrado.</div>`;
      return;
    }

    let html = `
      <table class="table table-striped table-bordered table-sm">
        <thead class="table-dark">
          <tr>
            <th>Ano</th>
            <th>Universidade</th>
            <th>Sigla</th>
            <th>Curso</th>
            <th>Cidade</th>
            <th>UF</th>
            <th>Cód. MEC</th>
            <th>Nota Enade (Contínuo)</th>
          </tr>
        </thead>
        <tbody>
    `;
    
    count = 0;

    lista.forEach(l => {
      const nomeIES = l["Nome da IES*"] || l["Nome da IES"] || "";
      const siglaIES = l["Sigla da IES*"] || l["Sigla da IES"] || "";
      const uf = l["Sigla da UF**"] || l["Sigla da UF** "] || l["Sigla da UF"] || "";
      const cidade = l["Município do Curso**"] || l["Município do Curso"] || "";
      const codCurso = l["Código do Curso"] || "";
      const nota = l["Conceito Enade (Contínuo)"] || "";
      const faixa = l["Conceito Enade (Faixa)"] || "";

      html += `
        <tr>
          <td>${l["Ano"]}</td>
          <td>${nomeIES}</td>
          <td>${siglaIES}</td>
          <td>${l["Área de Avaliação"]}</td>
          <td>${cidade}</td>
          <td>${uf}</td>
          <td>${codCurso}</td>
          <td>${nota}</td>
        </tr>
      `;
      count += 1;
    });

    html += "</tbody></table>";
    if(count == 30)
	html += "<p>Somente exibindo os primeiros 30 resultados encontrados.</p>";
    else
        html += "<p>Exibindo todos os "+count+" resultados encontrados.</p>";
    div.innerHTML = html;
  }

  // ---- Eventos ----
  document.getElementById('universidade').addEventListener('input', filtrarComEspera);
  document.getElementById('curso').addEventListener('input', filtrarComEspera);

  // ---- Inicialização ----
  carregarDados().then(() => console.log("Dados ENADE carregados."));
</script>
</body>
</html>
